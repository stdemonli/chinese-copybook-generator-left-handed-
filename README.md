# 汉字笔顺字帖生成器 (Chinese Calligraphy Generator)

一个基于 Python 的汉字字帖生成工具。支持生成米字格、田字格等多种练习纸，核心特色是支持**汉字笔顺分解**、**智能居中排版**以及**多页 PDF 输出**。

适用于书法练习、儿童识字教学、对外汉语教学等场景。

---

## ✨ 核心特性

### 1. 强大的笔顺分解

* **SVG 矢量笔顺**：基于 MakeMeHanzi 数据库，提供高质量的笔顺数据
* **智能算法**：
  * **几何重心自动对齐**：自动计算汉字实际包围盒重心，解决部分汉字（如"饕"）在格子里位置偏下或偏上的问题
  * **防溢出保护**：统一缩放比例（0.88），既保证书写饱满，又防止长笔画（撇、捺、钩）戳出格子
* **逐笔描红**：笔顺分解模式下，已写笔画为灰色，未写笔画隐藏，提供纯净的描红体验

### 2. 高度可定制化

* **版式设置**：支持 A4、A5 及自定义纸张尺寸；支持自定义行列数
* **网格样式**：米字格、田字格、口字格；支持自定义颜色（粉、红、灰、黑）
* **练习模式**：
  * **笔顺分解**：范字 + 逐笔分解 + 剩余格子填充
  * **全描红**：所有格子均为浅灰色描红
  * **一半描红**：前一半描红，后一半留空
  * **临摹**：仅首字为范字，其余留空
* **左手模式**：专为左撇子设计，范字在最右侧，笔顺从右向左排列，防止手部遮挡范字

### 3. 智能排版与输出

* **多页 PDF 生成**：支持长文本自动分页，一键生成完整的字帖文件
* **特殊占位符**：输入 `#` 号可强制跳过当前行（留空），便于制作分割或留白
* **自动换行**：笔顺分解如果一行写不完，会自动顺延至下一行（支持从左向右和从右向左两种流向）

---

## 🛠️ 环境依赖

### 系统要求
* Python 3.8+
* Windows 操作系统

### Python 库依赖
* Matplotlib
* Numpy
* Tkinter（通常随 Python 安装）
* svgpath2mpl

---

## 🚀 快速开始

### 1. 创建虚拟环境

建议使用虚拟环境运行：

```bash
# 创建虚拟环境 (Windows)
python -m venv venv

# 激活虚拟环境
.\venv\Scripts\activate
```

### 2. 安装依赖库

```bash
# 安装项目依赖
pip install -r requirements.txt
```

### 3. requirements.txt 内容

```txt
matplotlib>=3.5.0
numpy>=1.21.0
svgpath2mpl
```

### 4. 资源文件准备

确保项目根目录下有 `resources` 文件夹，并包含以下文件：

* **strokes.txt**：笔顺数据文件（每行为 JSON 格式）
* **simkai.ttf**：楷体字体文件（或其他支持中文的 TTF 字体），用于显示范字和标题

---

## 📖 使用指南

### 界面参数说明

#### 基础设置
* **纸张**：推荐使用 A4
* **书写模式**：
  * 右手：范字在左，从左向右写
  * 左手：范字在右，从右向左写
* **字体**：点击浏览选择系统中的 .ttf 字体文件

#### 样式外观
* **格子大小**：推荐"自动"，程序会根据纸张大小和行列数自动计算最大合适的格子
* **模式**：选择"笔顺分解"可生成带笔画步骤的字帖
* **填充**：在笔顺分解模式下，笔顺写完后，当行剩余格子可选择"剩余描红"或"剩余留空"

#### 分页设置
* **单页模式**：仅生成一页 PDF，适合生成样张。可勾选"单页循环填满"
* **多页模式**：自动处理长文本，生成多页 PDF

### 输入框技巧

#### 普通输入
直接输入汉字，如：
```
天地玄黄
```

#### 空行控制
输入 `#` 字符，该行将被留空（不画格子内容）。

#### 示例输入
```
我爱你中国
#
汉字练习
```

**效果**：
* 第一行写"我爱你中国"
* 第二行留空
* 第三行写"汉字练习"

---

## 📂 项目结构

```
字帖生成器v1/
├── resources/                     # 资源文件夹
│   ├── strokes.txt               # 核心笔顺数据
│   └── simkai.ttf                # 默认字体文件
├── src/                          # 源代码目录
│   ├── main.py                   # GUI 入口与交互逻辑
│   ├── generator.py              # 核心绘图与排版引擎
│   └── __pycache__/              # Python 缓存目录
├── venv/                         # 虚拟环境
├── requirements.txt              # 依赖列表
├── 1.一键配置环境.bat             # Windows 环境配置脚本
├── 2.启动字帖生成器.bat            # Windows 启动脚本
├── launcher_basic.bat            # 基础启动脚本
├── 字帖_A4.pdf                   # 生成样例文件
├── 字帖_A42.pdf                  # 生成样例文件
├── 字帖_A45.pdf                  # 生成样例文件
└── README.md                     # 项目说明文档
```

---

## ⚠️ 常见问题

### Q: 生成的字帖里有些字显示为红色的 "?"

**A**: 这说明 strokes.txt 数据文件中缺少该字的笔顺数据。程序会尝试用字体文件显示黑色的范字，但无法进行笔顺分解。

**解决方案**：
1. 检查 strokes.txt 文件是否完整
2. 确认输入的字符是否在笔顺数据库中
3. 联系开发者添加缺失字符的笔顺数据

### Q: 笔顺分解模式下，字的大小和范字不一样？

**A**: 我们在最新版本中使用了统一的缩放算法（0.88）和几何重心对齐，理论上笔顺字和描红字的大小、位置应完全一致。如果出现偏差，请检查是否修改了 padding_factor 参数。

**解决方案**：
1. 确认使用的是默认的 0.88 缩放比例
2. 检查几何重心对齐算法是否正常工作
3. 重新生成字帖，看问题是否依然存在

---

## 🎯 快速启动

### Windows 用户
直接双击运行以下批处理文件：

1. **配置环境**：`1.一键配置环境.bat`
2. **启动程序**：`2.启动字帖生成器.bat`

### 手动启动
```bash
# 激活虚拟环境
.\venv\Scripts\activate

# 启动程序
python src/main.py
```

---

## 📞 技术支持

如果您在使用过程中遇到问题，可以：

1. 检查本文档的常见问题部分
2. 确认所有依赖库版本符合要求
3. 验证资源文件路径和完整性

**祝您使用愉快！** 🎉